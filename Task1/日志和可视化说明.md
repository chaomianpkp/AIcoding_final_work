# Task1 训练日志和可视化说明

## 新增功能

### 1. 训练时间记录
- ✅ 记录每个epoch的训练时间
- ✅ 记录总训练时间
- ✅ 记录平均每个epoch的时间
- ✅ 在控制台输出时间统计

### 2. 训练日志保存
- ✅ 自动保存训练日志到JSON文件
- ✅ 记录所有训练指标（loss、准确率、学习率等）
- ✅ 记录训练配置信息
- ✅ 日志文件名包含时间戳和配置信息

### 3. 可视化工具
- ✅ 绘制训练曲线（loss、准确率、学习率）
- ✅ 支持对比多个训练日志
- ✅ 自动保存图片到 `./figures/` 目录
- ✅ 自动创建保存目录（如果不存在）

## 使用方法

### 训练并生成日志

```bash
# 基础训练（日志保存到 ./logs/）
python AIHW1.py --epochs 20 --batch-size 64 --optimizer adam --device gpu --use-augmentation

# 指定日志保存目录
python AIHW1.py --epochs 20 --batch-size 64 --optimizer adam --device gpu --log-dir ./my_logs

# 完整配置示例
python AIHW1.py \
    --model improved \
    --epochs 20 \
    --batch-size 64 \
    --optimizer adam \
    --lr 1e-3 \
    --weight-decay 5e-4 \
    --use-augmentation \
    --use-lr-scheduler \
    --lr-scheduler-mode exp \
    --lr-decay-factor 0.95 \
    --device gpu \
    --log-dir ./logs
```

### 可视化训练日志

#### 单个日志可视化

```bash
# 自动保存到 ./figures/ 目录（默认不显示）
python visualize_training.py --log-path ./logs/training_log_improved_adam_20241201_120000.json

# 指定保存路径
python visualize_training.py \
    --log-path ./logs/training_log_improved_adam_20241201_120000.json \
    --save-path ./my_figures/training_curves.png

# 显示图表（同时也会自动保存）
python visualize_training.py \
    --log-path ./logs/training_log_improved_adam_20241201_120000.json \
    --show
```

#### 对比多个训练日志

```bash
# 自动保存对比图到 ./figures/comparison.png
python visualize_training.py \
    --compare \
    ./logs/training_log_improved_adam_20241201_120000.json \
    ./logs/training_log_improved_sgd_20241201_130000.json

# 指定保存路径
python visualize_training.py \
    --compare \
    ./logs/training_log_improved_adam_20241201_120000.json \
    ./logs/training_log_improved_sgd_20241201_130000.json \
    --save-path ./my_figures/comparison.png
```

## 日志文件格式

日志文件为JSON格式，包含以下信息：

```json
{
  "config": {
    "model": "improved",
    "epochs": 20,
    "batch_size": 64,
    "lr": 0.001,
    "optimizer": "adam",
    "weight_decay": 0.0005,
    "use_augmentation": true,
    "use_lr_scheduler": true,
    "device": "cuda:0",
    "total_params": 1234567,
    ...
  },
  "training_history": [
    {
      "epoch": 1,
      "train_loss": 1.234,
      "train_acc": 45.67,
      "test_acc": 43.21,
      "learning_rate": 0.001,
      "epoch_time": 123.45,
      "test_time": 5.67
    },
    ...
  ],
  "timing": {
    "total_time": 2469.0,
    "avg_time_per_epoch": 123.45,
    "best_test_acc": 82.34
  }
}
```

## 可视化图表说明

生成的图表包含3个子图（不包含时间相关图表）：

1. **Training Loss**: 训练损失曲线
2. **Accuracy Curves**: 训练和测试准确率对比
3. **Learning Rate Schedule**: 学习率变化曲线

**注意**：时间统计信息仍然保存在日志文件中，但不在可视化图表中显示。

## 依赖安装

可视化功能需要matplotlib：

```bash
pip install matplotlib numpy
```

## 日志文件命名规则

日志文件自动命名格式：
```
training_log_{model}_{optimizer}_{timestamp}.json
```

例如：
- `training_log_improved_adam_20241201_120000.json`
- `training_log_simple_sgd_20241201_130000.json`

## 示例工作流

### 1. 训练多个配置并记录日志

```bash
# 配置1：Improved模型 + Adam + 数据增强
python AIHW1.py \
    --model improved \
    --optimizer adam \
    --use-augmentation \
    --epochs 20 \
    --log-dir ./logs

# 配置2：Improved模型 + SGD + 数据增强
python AIHW1.py \
    --model improved \
    --optimizer sgd \
    --use-augmentation \
    --epochs 20 \
    --log-dir ./logs

# 配置3：Simple模型 + Adam（无数据增强）
python AIHW1.py \
    --model simple \
    --optimizer adam \
    --epochs 20 \
    --log-dir ./logs
```

### 2. 可视化所有结果

```bash
# 查看单个训练结果
python visualize_training.py \
    --log-path ./logs/training_log_improved_adam_*.json \
    --save-path improved_adam_curves.png

# 对比所有配置
python visualize_training.py \
    --compare \
    ./logs/training_log_improved_adam_*.json \
    ./logs/training_log_improved_sgd_*.json \
    ./logs/training_log_simple_adam_*.json \
    --save-path all_comparison.png
```

## 时间统计输出示例

训练结束后会输出：

```
============================================================
Training completed!
============================================================
Best test accuracy: 82.34%
Total training time: 2469.00s (41.15 minutes)
Average time per epoch: 123.45s
Training log saved to: ./logs/training_log_improved_adam_20241201_120000.json
============================================================
```

## 注意事项

1. **日志目录**：默认保存到 `./logs/`，如果目录不存在会自动创建
2. **图片目录**：默认保存到 `./figures/`，如果目录不存在会自动创建
3. **自动保存**：可视化脚本会自动保存图片，无需指定 `--save-path`（会自动生成文件名）
4. **时间记录**：时间信息保存在日志文件中，但不在可视化图表中显示
5. **JSON格式**：日志使用UTF-8编码，支持中文注释
6. **可视化**：需要安装matplotlib和numpy库
7. **文件大小**：日志文件通常很小（几KB到几十KB），不会占用太多空间
8. **默认行为**：默认只保存图片不显示（使用 `--show` 参数可显示图表）

## 在报告中使用

训练日志可以用于：
- 生成训练曲线图
- 对比不同配置的性能
- 分析训练时间和效率
- 记录实验配置和结果

